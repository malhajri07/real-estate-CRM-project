{
  "name": "Executive Overview - Real Estate CRM",
  "description": "High-level KPIs and metrics for executive dashboard",
  "parameters": [
    {
      "name": "Date Range",
      "slug": "date_range",
      "type": "date/range",
      "default": "past30days"
    },
    {
      "name": "Organization",
      "slug": "organization",
      "type": "string/=",
      "default": null
    }
  ],
  "cards": [
    {
      "name": "Total Users",
      "description": "Total number of registered users",
      "query": {
        "source-table": "dim_user",
        "aggregation": [["count"]],
        "filter": ["=", ["field", "is_active", null], true]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "count",
        "scalar.prefix": "",
        "scalar.suffix": " users"
      }
    },
    {
      "name": "Active Properties",
      "description": "Number of active properties",
      "query": {
        "source-table": "stg_properties",
        "aggregation": [["count"]],
        "filter": ["=", ["field", "status", null], "AVAILABLE"]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "count",
        "scalar.prefix": "",
        "scalar.suffix": " properties"
      }
    },
    {
      "name": "Open Buyer Requests",
      "description": "Number of open buyer requests",
      "query": {
        "source-table": "stg_buyer_requests",
        "aggregation": [["count"]],
        "filter": ["=", ["field", "status", null], "OPEN"]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "count",
        "scalar.prefix": "",
        "scalar.suffix": " requests"
      }
    },
    {
      "name": "Monthly Revenue",
      "description": "Monthly recurring revenue",
      "query": {
        "source-table": "stg_payments",
        "aggregation": [["sum", ["field", "amount", null]]],
        "filter": [
          "and",
          ["=", ["field", "status", null], "SUCCESS"],
          ["=", ["field", "plan_type", null], "MONTHLY"]
        ]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "sum",
        "scalar.prefix": "SAR ",
        "scalar.suffix": ""
      }
    },
    {
      "name": "Users by Role",
      "description": "Distribution of users by role",
      "query": {
        "source-table": "dim_user",
        "aggregation": [["count"]],
        "breakout": [["field", "primary_role", null]],
        "filter": ["=", ["field", "is_active", null], true]
      },
      "display": "pie",
      "visualization_settings": {
        "pie.column": "primary_role",
        "pie.metric": "count"
      }
    },
    {
      "name": "Claim to Lead Conversion Rate",
      "description": "Percentage of claims converted to leads",
      "query": {
        "source-table": "fct_claim",
        "aggregation": [
          ["count"],
          ["count", ["field", "is_converted", null]]
        ],
        "filter": ["=", ["field", "is_converted", null], true]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "count",
        "scalar.prefix": "",
        "scalar.suffix": "%"
      }
    },
    {
      "name": "Lead Win Rate",
      "description": "Percentage of closed leads that were won",
      "query": {
        "source-table": "fct_lead",
        "aggregation": [
          ["count", ["field", "is_won", null]],
          ["count", ["field", "is_closed", null]]
        ],
        "filter": ["=", ["field", "is_closed", null], true]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "count",
        "scalar.prefix": "",
        "scalar.suffix": "%"
      }
    },
    {
      "name": "Time to First Claim (Median)",
      "description": "Median time from buyer request to first claim",
      "query": {
        "source-table": "fct_claim",
        "aggregation": [["median", ["field", "claim_duration_hours", null]]],
        "filter": ["not-null", ["field", "claim_duration_hours", null]]
      },
      "display": "scalar",
      "visualization_settings": {
        "scalar.field": "median",
        "scalar.prefix": "",
        "scalar.suffix": " hours"
      }
    },
    {
      "name": "Daily Active Users",
      "description": "Daily active users over time",
      "query": {
        "source-table": "fct_web_analytics",
        "aggregation": [["count"]],
        "breakout": [["field", "date_key", {"temporal-unit": "day"}]],
        "filter": [
          "and",
          ["=", ["field", "event_type", null], "user_logged_in"],
          ["time-interval", ["field", "date_key", null], -30, "day"]
        ]
      },
      "display": "line",
      "visualization_settings": {
        "graph.x_axis.title_text": "Date",
        "graph.y_axis.title_text": "Active Users"
      }
    },
    {
      "name": "Revenue Trend",
      "description": "Monthly revenue trend",
      "query": {
        "source-table": "stg_payments",
        "aggregation": [["sum", ["field", "amount", null]]],
        "breakout": [["field", "created_at", {"temporal-unit": "month"}]],
        "filter": [
          "and",
          ["=", ["field", "status", null], "SUCCESS"],
          ["time-interval", ["field", "created_at", null], -12, "month"]
        ]
      },
      "display": "line",
      "visualization_settings": {
        "graph.x_axis.title_text": "Month",
        "graph.y_axis.title_text": "Revenue (SAR)"
      }
    }
  ]
}
